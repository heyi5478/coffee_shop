import{_ as E,t as w,e as p,a as r,c as d,F as x,f as i,b as e,z as I,D as y,u as _,w as T,g as m,v as V,x as L,E as v}from"./index-aZdFltwy.js";import{t as U}from"./toastMessage-USI9f4B-.js";import{S as C}from"./sweetalert2.all-i4WpTOc4.js";import{O as B}from"./OrderTimeLine-9BYeosqs.js";var O={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"makeacoffee",BASE_URL:"/coffee_shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:c,VITE_PATH:u}=O,S={components:{OrderTimeLine:B},data(){return{step:1,products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1,coupon_code:""}},methods:{...w(U,["pushMessage"]),deleteAllCarts(){this.isLoading=!0;const s=`${c}/api/${u}/carts`;this.$http.delete(s).then(()=>{C.fire({position:"center",icon:"success",title:"購物車已清空",showConfirmButton:!1,timer:1500}),this.getCart(),this.isLoading=!1}).catch(t=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"清除購物車",content:t.response.data.message})})},getCart(){const s=`${c}/api/${u}/cart`;this.isLoading=!0,this.$http.get(s).then(t=>{this.cart=t.data.data,this.isLoading=!1}).catch(t=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得購物車資訊",content:t.response.data.message})})},removeCartItem(s){this.status.loadingItem=s;const t=`${c}/api/${u}/cart/${s}`;this.isLoading=!0,this.$http.delete(t).then(()=>{C.fire({position:"center",icon:"success",title:"移除購物車品項",showConfirmButton:!1,timer:1500}),this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(n=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"移除購物車品項",content:n.response.data.message})})},updateCart(s){this.isLoading=!0;const t=`${c}/api/${u}/cart/${s.id}`,n={product_id:s.product_id,qty:s.qty};s.qty===0?this.removeCartItem(s.id):s.qty>=100?(n.qty=100,this.pushMessage({style:"danger",title:"數量不可以超過 100"})):s.qty<0?(n.qty=1,this.pushMessage({style:"danger",title:"數量不可以小於 1"})):this.$http.put(t,{data:n}).then(f=>{this.pushMessage({style:"success",title:"更新購物車",content:f.data.message}),this.isLoading=!1,this.getCart()}).catch(f=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"更新購物車",content:f.response.data.message})})},addCouponCode(){const s=`${c}/api/${u}/coupon`,t={code:this.coupon_code};this.isLoading=!0,this.$http.post(s,{data:t}).then(n=>{this.pushMessage({style:"success",title:"加入優惠券",content:n.data.message}),this.getCart(),this.isLoading=!1}).catch(n=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"加入優惠券",content:n.response.data.message})})},createOrder(){this.isLoading=!0;const s=`${c}/api/${u}/order`,t=this.form;this.$http.post(s,{data:t}).then(()=>{this.$router.push("/ordersuccess"),this.$refs.form.resetForm(),this.isLoading=!1}).catch(n=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"建立訂單",content:n.response.data.message})})}},created(){this.getCart()}},A={class:"container"},F={class:"mt-4"},D={class:"mb-4"},$={class:"text-end"},R={class:"table align-middle"},N=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"110px"}},"數量"),e("th",null,"單價")])],-1),z=["disabled","onClick"],P=e("i",{class:"bi bi-x"},null,-1),H=[P],j={key:0,class:"text-success"},G={class:"input-group input-group-sm"},J=["onUpdate:modelValue","onBlur"],K={class:"input-group-text"},Q={class:"text-end"},W={key:0,class:"text-success"},X=e("td",{colspan:"3",class:"text-end"},"總計",-1),Y={class:"text-end"},Z={key:0},ee=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),te={class:"text-end text-success"},se={class:"my-5 row justify-content-center"},oe=e("p",{class:"text-center text-danger"},"星號欄位必填",-1),ae={class:"mb-3"},le=e("label",{for:"email",class:"form-label"},[m("Email"),e("span",{class:"text-danger"},"*")],-1),ne={class:"mb-3"},ie=e("label",{for:"name",class:"form-label"},[m("收件人姓名"),e("span",{class:"text-danger"},"*")],-1),re={class:"mb-3"},de=e("label",{for:"tel",class:"form-label"},[m("收件人電話"),e("span",{class:"text-danger"},"*")],-1),ce={class:"mb-3"},ue=e("label",{for:"address",class:"form-label"},[m("收件人地址"),e("span",{class:"text-danger"},"*")],-1),me={class:"mb-3"},he=e("label",{for:"message",class:"form-label"},"備註",-1),pe=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary"},"送出訂單")],-1),_e={key:1,class:"py-10 text-center"},fe=e("p",{class:"fs-5 mb-14"},"購物車無商品，快去購買喜歡的甜點吧！",-1);function ge(s,t,n,f,o,h){const k=p("VueLoading"),M=p("OrderTimeLine"),g=p("VeeField"),b=p("ErrorMessage"),q=p("VeeForm");return r(),d("div",A,[o.cart.carts.length?(r(),d(x,{key:0},[i(k,{active:o.isLoading,"z-index":1060},null,8,["active"]),e("div",F,[e("div",D,[i(M,{step:o.step},null,8,["step"])]),e("div",$,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:t[0]||(t[0]=(...a)=>h.deleteAllCarts&&h.deleteAllCarts(...a))}," 清空購物車 ")]),e("table",R,[N,e("tbody",null,[o.cart.carts?(r(!0),d(x,{key:0},I(o.cart.carts,a=>(r(),d("tr",{key:a.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:o.status.loadingItem===a.id,onClick:l=>h.removeCartItem(a.id)},H,8,z)]),e("td",null,[m(_(a.product.title)+" ",1),a.coupon?(r(),d("div",j,"已套用優惠券")):y("",!0)]),e("td",null,[e("div",G,[V(e("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":l=>a.qty=l,onBlur:l=>h.updateCart(a)},null,40,J),[[L,a.qty,void 0,{number:!0}]]),e("div",K,"/ "+_(a.product.unit),1)])]),e("td",Q,[o.cart.final_total!==o.cart.total?(r(),d("small",W,"折扣價：")):y("",!0),m(" "+_(s.$filters.currency(a.final_total)),1)])]))),128)):y("",!0)]),e("tfoot",null,[e("tr",null,[X,e("td",Y,_(s.$filters.currency(o.cart.total)),1)]),o.cart.final_total!==o.cart.total?(r(),d("tr",Z,[ee,e("td",te,_(s.$filters.currency(o.cart.final_total)),1)])):y("",!0)])])]),e("div",se,[oe,i(q,{ref:"form",class:"col-md-6",onSubmit:h.createOrder},{default:T(({errors:a})=>[e("div",ae,[le,i(g,{id:"email",name:"email",type:"email",class:v(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=l=>o.form.user.email=l)},null,8,["class","modelValue"]),i(b,{name:"email",class:"invalid-feedback"})]),e("div",ne,[ie,i(g,{id:"name",name:"姓名",type:"text",class:v(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=l=>o.form.user.name=l)},null,8,["class","modelValue"]),i(b,{name:"姓名",class:"invalid-feedback"})]),e("div",re,[de,i(g,{id:"tel",name:"電話",type:"tel",class:v(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:o.form.user.tel,"onUpdate:modelValue":t[3]||(t[3]=l=>o.form.user.tel=l)},null,8,["class","modelValue"]),i(b,{name:"電話",class:"invalid-feedback"})]),e("div",ce,[ue,i(g,{id:"address",name:"地址",type:"text",class:v(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":t[4]||(t[4]=l=>o.form.user.address=l)},null,8,["class","modelValue"]),i(b,{name:"地址",class:"invalid-feedback"})]),e("div",me,[he,V(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[5]||(t[5]=l=>o.form.message=l)},null,512),[[L,o.form.message]])]),pe]),_:1},8,["onSubmit"])])],64)):(r(),d("div",_e,[fe,e("button",{type:"button",class:"btn btn-secondary text-white rounded-1 px-6 px-md-10 py-2 py-md-4",onClick:t[6]||(t[6]=a=>s.$router.push("/products"))}," 購物去 ")]))])}const Ve=E(S,[["render",ge]]);export{Ve as default};
