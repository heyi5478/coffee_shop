import{_ as M,D as I,t as v,e as u,a as r,c as d,F as y,f as n,b as e,z as O,E as h,u as m,w as S,g as c,v as V,x as C,G as f}from"./index-BLnubCSt.js";import{t as A}from"./toastMessage-zZuzxCg7.js";import{O as F}from"./OrderTimeLine-cNrLQCo9.js";import{c as x}from"./cartStore-M8yFbYQL.js";var q={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"makeacoffee",BASE_URL:"/coffee_shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:k,VITE_PATH:L}=q,B={components:{OrderTimeLine:F},data(){return{step:1,product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},isLoading:!1,coupon_code:""}},computed:{...I(x,["cart","carts"])},methods:{...v(A,["pushMessage"]),...v(x,["getCart","deleteAllCarts","removeCartItem","updateCart"]),addCouponCode(){const s=`${k}/api/${L}/coupon`,t={code:this.coupon_code};this.isLoading=!0,this.$http.post(s,{data:t}).then(i=>{this.pushMessage({style:"success",title:"加入優惠券",content:i.data.message}),this.getCart(),this.isLoading=!1}).catch(i=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"加入優惠券",content:i.response.data.message})})},createOrder(){this.isLoading=!0;const s=`${k}/api/${L}/order`,t=this.form;this.$http.post(s,{data:t}).then(()=>{this.$router.push("/ordersuccess"),this.$refs.form.resetForm(),this.isLoading=!1}).catch(i=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"建立訂單",content:i.response.data.message})})}},created(){this.getCart()}},D={class:"container"},R={class:"mt-4 row justify-content-center"},$={class:"mb-4 mt-9"},N={class:"col-md-8"},z={class:"text-end"},P={class:"table align-middle"},j=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"110px"}},"數量"),e("th",null,"單價")])],-1),H=["disabled","onClick"],G=e("i",{class:"bi bi-x"},null,-1),J=[G],K={key:0,class:"text-success"},Q={class:"input-group input-group-sm"},W=["onUpdate:modelValue","onBlur"],X={class:"input-group-text"},Y={class:"text-end"},Z={key:0,class:"text-success"},ee=e("td",{colspan:"3",class:"text-end"},"總計",-1),se={class:"text-end"},te={key:0},oe=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ae={class:"text-end text-success"},le={class:"my-5 row justify-content-center"},ne=e("p",{class:"text-center text-danger"},"星號欄位必填",-1),re={class:"mb-3"},de=e("label",{for:"email",class:"form-label"},[c("Email"),e("span",{class:"text-danger"},"*")],-1),ie={class:"mb-3"},ce=e("label",{for:"name",class:"form-label"},[c("收件人姓名"),e("span",{class:"text-danger"},"*")],-1),ue={class:"mb-3"},me=e("label",{for:"tel",class:"form-label"},[c("收件人電話"),e("span",{class:"text-danger"},"*")],-1),pe={class:"mb-3"},_e=e("label",{for:"address",class:"form-label"},[c("收件人地址"),e("span",{class:"text-danger"},"*")],-1),he={class:"mb-3"},fe=e("label",{for:"message",class:"form-label"},"備註",-1),be=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary"},"送出訂單")],-1),ge={key:1,class:"py-10 text-center"},ve=e("p",{class:"fs-5 mb-14"},"購物車無商品，快去購買喜歡的甜點吧！",-1);function ye(s,t,i,Ve,a,E){var b,g;const T=u("VueLoading"),U=u("OrderTimeLine"),p=u("VeeField"),_=u("ErrorMessage"),w=u("VeeForm");return r(),d("div",D,[(g=(b=s.cart)==null?void 0:b.carts)!=null&&g.length?(r(),d(y,{key:0},[n(T,{active:a.isLoading,"z-index":1060},null,8,["active"]),e("div",R,[e("div",$,[n(U,{step:a.step},null,8,["step"])]),e("div",N,[e("div",z,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:t[0]||(t[0]=(...o)=>s.deleteAllCarts&&s.deleteAllCarts(...o))}," 清空購物車 ")]),e("table",P,[j,e("tbody",null,[s.cart.carts?(r(!0),d(y,{key:0},O(s.cart.carts,o=>(r(),d("tr",{key:o.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:a.status.loadingItem===o.id,onClick:l=>s.removeCartItem(o.id)},J,8,H)]),e("td",null,[c(m(o.product.title)+" ",1),o.coupon?(r(),d("div",K,"已套用優惠券")):h("",!0)]),e("td",null,[e("div",Q,[V(e("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":l=>o.qty=l,onBlur:l=>s.updateCart(o)},null,40,W),[[C,o.qty,void 0,{number:!0}]]),e("div",X,"/ "+m(o.product.unit),1)])]),e("td",Y,[s.cart.final_total!==s.cart.total?(r(),d("small",Z,"折扣價：")):h("",!0),c(" "+m(s.$filters.currency(o.final_total)),1)])]))),128)):h("",!0)]),e("tfoot",null,[e("tr",null,[ee,e("td",se,m(s.$filters.currency(s.cart.total)),1)]),s.cart.final_total!==s.cart.total?(r(),d("tr",te,[oe,e("td",ae,m(s.$filters.currency(s.cart.final_total)),1)])):h("",!0)])])])]),e("div",le,[ne,n(w,{ref:"form",class:"col-md-8",onSubmit:E.createOrder},{default:S(({errors:o})=>[e("div",re,[de,n(p,{id:"email",name:"email",type:"email",class:f(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:a.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=l=>a.form.user.email=l)},null,8,["class","modelValue"]),n(_,{name:"email",class:"invalid-feedback"})]),e("div",ie,[ce,n(p,{id:"name",name:"姓名",type:"text",class:f(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:a.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=l=>a.form.user.name=l)},null,8,["class","modelValue"]),n(_,{name:"姓名",class:"invalid-feedback"})]),e("div",ue,[me,n(p,{id:"tel",name:"電話",type:"tel",class:f(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:a.form.user.tel,"onUpdate:modelValue":t[3]||(t[3]=l=>a.form.user.tel=l)},null,8,["class","modelValue"]),n(_,{name:"電話",class:"invalid-feedback"})]),e("div",pe,[_e,n(p,{id:"address",name:"地址",type:"text",class:f(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:a.form.user.address,"onUpdate:modelValue":t[4]||(t[4]=l=>a.form.user.address=l)},null,8,["class","modelValue"]),n(_,{name:"地址",class:"invalid-feedback"})]),e("div",he,[fe,V(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[5]||(t[5]=l=>a.form.message=l)},null,512),[[C,a.form.message]])]),be]),_:1},8,["onSubmit"])])],64)):(r(),d("div",ge,[ve,e("button",{type:"button",class:"btn btn-secondary text-white rounded-1 px-6 px-md-10 py-2 py-md-4",onClick:t[6]||(t[6]=o=>s.$router.push("/products"))}," 購物去 ")]))])}const Ee=M(B,[["render",ye]]);export{Ee as default};
