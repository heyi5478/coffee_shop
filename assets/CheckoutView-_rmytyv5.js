import{_ as M,t as E,e as p,a as r,c as d,f as i,b as e,F as T,z as I,D as v,u as _,w as U,g as m,v as V,x,E as y}from"./index-W4KWbiXb.js";import{t as q}from"./toastMessage-Ifc1Oe7b.js";import{O}from"./OrderTimeLine-RrIMzfj5.js";var w={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"makeacoffee",BASE_URL:"/coffee_shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:c,VITE_PATH:u}=w,A={components:{OrderTimeLine:O},data(){return{step:1,products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1,coupon_code:""}},methods:{...E(q,["pushMessage"]),deleteAllCarts(){this.isLoading=!0;const a=`${c}/api/${u}/carts`;this.$http.delete(a).then(s=>{this.pushMessage({style:"success",title:"清除購物車",content:s.data.message}),this.getCart(),this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"清除購物車",content:s.response.data.message})})},getCart(){const a=`${c}/api/${u}/cart`;this.isLoading=!0,this.$http.get(a).then(s=>{this.cart=s.data.data,this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得購物車資訊",content:s.response.data.message})})},removeCartItem(a){this.status.loadingItem=a;const s=`${c}/api/${u}/cart/${a}`;this.isLoading=!0,this.$http.delete(s).then(n=>{this.pushMessage({style:"success",title:"移除購物車品項",content:n.data.message}),this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(n=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"移除購物車品項",content:n.response.data.message})})},updateCart(a){this.isLoading=!0;const s=`${c}/api/${u}/cart/${a.id}`,n={product_id:a.product_id,qty:a.qty};this.$http.put(s,{data:n}).then(g=>{this.pushMessage({style:"success",title:"更新購物車",content:g.data.message}),this.isLoading=!1,this.getCart()}).catch(g=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"更新購物車",content:g.response.data.message})})},addCouponCode(){const a=`${c}/api/${u}/coupon`,s={code:this.coupon_code};this.isLoading=!0,this.$http.post(a,{data:s}).then(n=>{this.pushMessage({style:"success",title:"加入優惠券",content:n.data.message}),this.getCart(),this.isLoading=!1}).catch(n=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"加入優惠券",content:n.response.data.message})})},createOrder(){this.isLoading=!0;const a=`${c}/api/${u}/order`,s=this.form;this.$http.post(a,{data:s}).then(()=>{this.$router.push("/ordersuccess"),this.$refs.form.resetForm(),this.isLoading=!1}).catch(n=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"建立訂單",content:n.response.data.message})})}},created(){this.getCart()}},F={class:"container"},B={class:"mt-4"},D={class:"mb-4"},S={class:"text-end"},R={class:"table align-middle"},$=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"110px"}},"數量"),e("th",null,"單價")])],-1),N=["disabled","onClick"],z=e("i",{class:"bi bi-x"},null,-1),P=[z],H={key:0,class:"text-success"},j={class:"input-group input-group-sm"},G=["onUpdate:modelValue","onBlur"],J={class:"input-group-text"},K={class:"text-end"},Q={key:0,class:"text-success"},W=e("td",{colspan:"3",class:"text-end"},"總計",-1),X={class:"text-end"},Y={key:0},Z=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ee={class:"text-end text-success"},se={class:"my-5 row justify-content-center"},te=e("p",{class:"text-center text-danger"},"星號欄位必填",-1),ae={class:"mb-3"},oe=e("label",{for:"email",class:"form-label"},[m("Email"),e("span",{class:"text-danger"},"*")],-1),le={class:"mb-3"},ne=e("label",{for:"name",class:"form-label"},[m("收件人姓名"),e("span",{class:"text-danger"},"*")],-1),ie={class:"mb-3"},re=e("label",{for:"tel",class:"form-label"},[m("收件人電話"),e("span",{class:"text-danger"},"*")],-1),de={class:"mb-3"},ce=e("label",{for:"address",class:"form-label"},[m("收件人地址"),e("span",{class:"text-danger"},"*")],-1),ue={class:"mb-3"},me=e("label",{for:"message",class:"form-label"},"備註",-1),he=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary"},"送出訂單")],-1);function pe(a,s,n,g,t,h){const L=p("VueLoading"),C=p("OrderTimeLine"),f=p("VeeField"),b=p("ErrorMessage"),k=p("VeeForm");return r(),d("div",F,[i(L,{active:t.isLoading,"z-index":1060},null,8,["active"]),e("div",B,[e("div",D,[i(C,{step:t.step},null,8,["step"])]),e("div",S,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...o)=>h.deleteAllCarts&&h.deleteAllCarts(...o))}," 清空購物車 ")]),e("table",R,[$,e("tbody",null,[t.cart.carts?(r(!0),d(T,{key:0},I(t.cart.carts,o=>(r(),d("tr",{key:o.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:t.status.loadingItem===o.id,onClick:l=>h.removeCartItem(o.id)},P,8,N)]),e("td",null,[m(_(o.product.title)+" ",1),o.coupon?(r(),d("div",H,"已套用優惠券")):v("",!0)]),e("td",null,[e("div",j,[V(e("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":l=>o.qty=l,onBlur:l=>h.updateCart(o)},null,40,G),[[x,o.qty,void 0,{number:!0}]]),e("div",J,"/ "+_(o.product.unit),1)])]),e("td",K,[t.cart.final_total!==t.cart.total?(r(),d("small",Q,"折扣價：")):v("",!0),m(" "+_(a.$filters.currency(o.final_total)),1)])]))),128)):v("",!0)]),e("tfoot",null,[e("tr",null,[W,e("td",X,_(a.$filters.currency(t.cart.total)),1)]),t.cart.final_total!==t.cart.total?(r(),d("tr",Y,[Z,e("td",ee,_(a.$filters.currency(t.cart.final_total)),1)])):v("",!0)])])]),e("div",se,[te,i(k,{ref:"form",class:"col-md-6",onSubmit:h.createOrder},{default:U(({errors:o})=>[e("div",ae,[oe,i(f,{id:"email",name:"email",type:"email",class:y(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:t.form.user.email,"onUpdate:modelValue":s[1]||(s[1]=l=>t.form.user.email=l)},null,8,["class","modelValue"]),i(b,{name:"email",class:"invalid-feedback"})]),e("div",le,[ne,i(f,{id:"name",name:"姓名",type:"text",class:y(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:t.form.user.name,"onUpdate:modelValue":s[2]||(s[2]=l=>t.form.user.name=l)},null,8,["class","modelValue"]),i(b,{name:"姓名",class:"invalid-feedback"})]),e("div",ie,[re,i(f,{id:"tel",name:"電話",type:"tel",class:y(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:t.form.user.tel,"onUpdate:modelValue":s[3]||(s[3]=l=>t.form.user.tel=l)},null,8,["class","modelValue"]),i(b,{name:"電話",class:"invalid-feedback"})]),e("div",de,[ce,i(f,{id:"address",name:"地址",type:"text",class:y(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:t.form.user.address,"onUpdate:modelValue":s[4]||(s[4]=l=>t.form.user.address=l)},null,8,["class","modelValue"]),i(b,{name:"地址",class:"invalid-feedback"})]),e("div",ue,[me,V(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[5]||(s[5]=l=>t.form.message=l)},null,512),[[x,t.form.message]])]),he]),_:1},8,["onSubmit"])])])}const be=M(A,[["render",pe]]);export{be as default};
