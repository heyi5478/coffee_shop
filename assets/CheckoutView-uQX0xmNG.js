import{_ as k,t as M,r as f,o as r,c as d,a as i,b as e,F as E,z as I,D as b,u as h,w as U,e as y,v as V,x as L,E as v}from"./index-rEPnb7pY.js";import{t as q}from"./toastMessage-O14MpTf1.js";var T={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"makeacoffee",BASE_URL:"/coffee_shop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:c,VITE_PATH:u}=T,w={data(){return{products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1,coupon_code:""}},methods:{...M(q,["pushMessage"]),deleteAllCarts(){this.isLoading=!0;const a=`${c}/api/${u}/carts`;this.$http.delete(a).then(s=>{this.pushMessage({style:"success",title:"清除購物車",content:s.data.message}),this.getCart(),this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"清除購物車",content:s.response.data.message})})},getCart(){const a=`${c}/api/${u}/cart`;this.isLoading=!0,this.$http.get(a).then(s=>{this.cart=s.data.data,this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得購物車資訊",content:s.response.data.message})})},removeCartItem(a){this.status.loadingItem=a;const s=`${c}/api/${u}/cart/${a}`;this.isLoading=!0,this.$http.delete(s).then(n=>{this.pushMessage({style:"success",title:"移除購物車品項",content:n.data.message}),this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(n=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"移除購物車品項",content:n.response.data.message})})},updateCart(a){this.isLoading=!0;const s=`${c}/api/${u}/cart/${a.id}`,n={product_id:a.product_id,qty:a.qty};this.$http.put(s,{data:n}).then(p=>{this.pushMessage({style:"success",title:"更新購物車",content:p.data.message}),this.isLoading=!1,this.getCart()}).catch(p=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"更新購物車",content:p.response.data.message})})},addCouponCode(){const a=`${c}/api/${u}/coupon`,s={code:this.coupon_code};this.isLoading=!0,this.$http.post(a,{data:s}).then(n=>{this.pushMessage({style:"success",title:"加入優惠券",content:n.data.message}),this.getCart(),this.isLoading=!1}).catch(n=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"加入優惠券",content:n.response.data.message})})},createOrder(){this.isLoading=!0;const a=`${c}/api/${u}/order`,s=this.form;this.$http.post(a,{data:s}).then(()=>{this.$router.push("/ordersuccess"),this.$refs.form.resetForm(),this.isLoading=!1}).catch(n=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"建立訂單",content:n.response.data.message})})}},created(){this.getCart()}},A={class:"container"},F={class:"mt-4"},B={class:"text-end"},D={class:"table align-middle"},S=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"110px"}},"數量"),e("th",null,"單價")])],-1),$=["disabled","onClick"],R=e("i",{class:"bi bi-x"},null,-1),N=[R],O={key:0,class:"text-success"},z={class:"input-group input-group-sm"},P=["onUpdate:modelValue","onBlur"],H={class:"input-group-text"},j={class:"text-end"},G={key:0,class:"text-success"},J=e("td",{colspan:"3",class:"text-end"},"總計",-1),K={class:"text-end"},Q={key:0},W=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),X={class:"text-end text-success"},Y={class:"my-5 row justify-content-center"},Z={class:"mb-3"},ee=e("label",{for:"email",class:"form-label"},"Email",-1),se={class:"mb-3"},te=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),ae={class:"mb-3"},oe=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),le={class:"mb-3"},ne=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ie={class:"mb-3"},re=e("label",{for:"message",class:"form-label"},"備註",-1),de=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function ce(a,s,n,p,t,m){const x=f("VueLoading"),_=f("VeeField"),g=f("ErrorMessage"),C=f("VeeForm");return r(),d("div",A,[i(x,{active:t.isLoading,"z-index":1060},null,8,["active"]),e("div",F,[e("div",B,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...o)=>m.deleteAllCarts&&m.deleteAllCarts(...o))}," 清空購物車 ")]),e("table",D,[S,e("tbody",null,[t.cart.carts?(r(!0),d(E,{key:0},I(t.cart.carts,o=>(r(),d("tr",{key:o.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:t.status.loadingItem===o.id,onClick:l=>m.removeCartItem(o.id)},N,8,$)]),e("td",null,[y(h(o.product.title)+" ",1),o.coupon?(r(),d("div",O,"已套用優惠券")):b("",!0)]),e("td",null,[e("div",z,[V(e("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":l=>o.qty=l,onBlur:l=>m.updateCart(o)},null,40,P),[[L,o.qty,void 0,{number:!0}]]),e("div",H,"/ "+h(o.product.unit),1)])]),e("td",j,[t.cart.final_total!==t.cart.total?(r(),d("small",G,"折扣價：")):b("",!0),y(" "+h(a.$filters.currency(o.final_total)),1)])]))),128)):b("",!0)]),e("tfoot",null,[e("tr",null,[J,e("td",K,h(a.$filters.currency(t.cart.total)),1)]),t.cart.final_total!==t.cart.total?(r(),d("tr",Q,[W,e("td",X,h(a.$filters.currency(t.cart.final_total)),1)])):b("",!0)])])]),e("div",Y,[i(C,{ref:"form",class:"col-md-6",onSubmit:m.createOrder},{default:U(({errors:o})=>[e("div",Z,[ee,i(_,{id:"email",name:"email",type:"email",class:v(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:t.form.user.email,"onUpdate:modelValue":s[1]||(s[1]=l=>t.form.user.email=l)},null,8,["class","modelValue"]),i(g,{name:"email",class:"invalid-feedback"})]),e("div",se,[te,i(_,{id:"name",name:"姓名",type:"text",class:v(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:t.form.user.name,"onUpdate:modelValue":s[2]||(s[2]=l=>t.form.user.name=l)},null,8,["class","modelValue"]),i(g,{name:"姓名",class:"invalid-feedback"})]),e("div",ae,[oe,i(_,{id:"tel",name:"電話",type:"tel",class:v(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:t.form.user.tel,"onUpdate:modelValue":s[3]||(s[3]=l=>t.form.user.tel=l)},null,8,["class","modelValue"]),i(g,{name:"電話",class:"invalid-feedback"})]),e("div",le,[ne,i(_,{id:"address",name:"地址",type:"text",class:v(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:t.form.user.address,"onUpdate:modelValue":s[4]||(s[4]=l=>t.form.user.address=l)},null,8,["class","modelValue"]),i(g,{name:"地址",class:"invalid-feedback"})]),e("div",ie,[re,V(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[5]||(s[5]=l=>t.form.message=l)},null,512),[[L,t.form.message]])]),de]),_:1},8,["onSubmit"])])])}const he=k(w,[["render",ce]]);export{he as default};
